<div align="center">
  <img src="Chubby Cat/logo.png" width="128" height="128" alt="Chubby Cat Logo">
  <h1>Chubby Cat</h1>
  <p><strong>将您的浏览器转化为由最新 AI 模型驱动的智能工作空间。</strong></p>

  <p>
    <img src="https://img.shields.io/badge/版本-1.6.0-blue" alt="Version">
    <img src="https://img.shields.io/badge/许可-MIT-green" alt="License">
    <img src="https://img.shields.io/badge/平台-Chrome_扩展-orange" alt="Platform">
  </p>
  
  <p>
    <a href="README_en.md">English</a> | <b>简体中文</b>
  </p>
</div>

---

## 📖 项目背景与目标

### 项目背景

在当今信息爆炸的数字时代，用户每天需要在浏览器中处理大量的信息检索、内容阅读和任务执行工作。传统的人工浏览方式效率低下，而现有的 AI 助手工具往往与浏览器生态割裂，用户需要频繁切换应用才能完成复杂的工作流程。

**Chubby Cat** 的诞生正是为了解决这一痛点。作为一款基于 Chrome 扩展的智能助手，它将先进的大语言模型能力直接嵌入浏览器核心工作流，实现"边浏览、边思考、边执行"的无缝 AI 协作体验。

### 项目目标

我们的核心愿景是构建一个**安全、高效、可扩展**的浏览器 AI 工作空间：

- **深度浏览器集成**：不仅读取网页内容，更能理解页面结构、执行用户意图，真正成为浏览器的一部分。
- **多模型统一接入**：支持 Google Gemini、Anthropic Claude、OpenAI 兼容接口等多种后端，让用户根据需求灵活选择。
- **隐私与安全优先**：所有数据处理在本地完成，API 密钥仅存储于本地存储，严格保护用户隐私。
- **强大的自动化能力**：通过 Agent 模式和 MCP 协议集成，让 AI 能够代表用户执行真实的浏览器操作。

### 版本演进历程

| 版本 | 主要更新 |
| :--- | :--- |
| **v1.6.0** | 聊天历史导出、文件附件支持、Gemini 模型列表管理、多模型管理优化、快捷短语面板改进 |
| **v1.5.0** | Grok 网页版支持、文档 OCR 处理功能、存储策略管理 |
| **v1.4.0** | MCP 协议集成、页面总结功能、右侧边栏、浮动侧边栏图标、设置界面重构 |
| **v1.3.0** | Claude API 支持、Markdown 导出功能、OpenAI/Claude 模型自动获取、MCP 服务器管理 |
| **v1.2.0** | Markdown 渲染优化、代码高亮、LaTeX 数学公式渲染、模糊搜索支持 |
| **v1.1.0** | 快捷消息功能、UI 优化调整 |
| **v1.0.0** | 初始版本发布，核心聊天功能 |

## ✨ 核心功能

### 🤖 统一模型枢纽

支持多种 AI 后端，满足不同场景下的性能与成本需求：

| 模型类型 | 特点 | 适用场景 |
| :--- | :--- | :--- |
| **Google Gemini** | 官方 API 支持 Pro/Flash 模型，支持网页端免费使用及多账号会话轮询 | 日常对话、快速问答、成本敏感场景 |
| **Anthropic Claude** | 官方 API 支持，集成扩展思考（Extended Thinking）选项 | 深度推理、长文本分析、复杂任务 |
| **xAI Grok** | 网页端支持（v1.5.0 新增） | 特定场景需求 |
| **OpenAI 兼容接口** | 连接至任何 OpenAI 兼容的提供商（OpenRouter、DeepSeek、本地 LLM 等），支持自定义模型 ID 和 Base URL | 私有化部署、多模型对比测试 |

### 📄 智能上下文管理

- **一键网页上下文**：瞬间将当前活动标签页的内容喂给 AI 进行分析，支持智能摘要提取。
- **多标签页关联**：跨页面研究时，可勾选多个打开的标签页并同时导入其内容，AI 将综合分析多源信息。
- **智能划词工具栏**：选中网页文本时自动弹出悬浮工具栏，支持一键总结、解释、翻译或继续追问。
- **快速提问（Quick Ask）**：通过右键菜单或快捷键快速唤起对话窗口，无需打开侧边栏即可获取即时答案。
- **页面总结**：AI 自动分析当前页面内容，生成结构化摘要（v1.4.0 新增）。

### 👁️ 视觉智能工具

- **高精度 OCR**：基于 Mistral OCR 技术，自由框选网页任何区域，精准提取文字内容。
- **智能截图输入**：捕捉视觉元素并直接作为多模态模型的提示词输入，支持复杂图表理解。
- **截图翻译**：专为处理图像内嵌文字或复杂排版设计的翻译工具，保持原文排版格式。
- **文档 OCR**：支持整文档 OCR 处理，提取扫描版 PDF 和图片文档中的文字（v1.5.0 新增）。
- **本地图片分析**：支持上传本地图片进行对话与识别，可用于图像内容问答、文档扫描等场景。

### 🛠️ 高级自动化与扩展

- **浏览器控制（Agent 模式）**：授权 AI 通过 Chrome Debugger API 进行导航、点击、填写表单及与网页元素交互，实现端到端的自动化任务。
- **MCP 协议集成**：全面支持 **Model Context Protocol**，允许扩展连接外部工具、本地文件及各类数据源，显著扩展 AI 能力边界（v1.4.0 正式集成）。
- **提示词增益**：内置"提示词优化"功能，通过深度分析和结构化调整，显著提升 AI 回答质量和相关性。
- **快捷短语**：预设常用提示词模板，一键调用，提高重复性任务的效率（v1.1.0 引入）。

### 📦 数据管理

- **聊天历史导出**：支持将对话记录导出为 Markdown 格式，便于保存和分享（v1.3.0 新增）。
- **存储策略管理**：灵活配置数据存储策略，支持自动清理过期数据（v1.5.0 新增）。
- **文件附件支持**：在对话中附加文件进行分析和处理（v1.6.0 新增）。

## 🏗️ 技术架构

### 技术栈概览

Chubby Cat 采用现代化的前端技术栈构建，确保高性能、可维护性和安全性：

| 层级 | 技术选型 | 说明 |
| :--- | :--- | :--- |
| **构建工具** | Vite 6 | 极速的开发体验和优化的生产构建 |
| **开发语言** | TypeScript 5.8 | 强类型支持，提升代码质量和可维护性 |
| **UI 框架** | 原生 DOM + HTML | 轻量级方案，减少依赖体积，提升加载速度 |
| **Markdown 渲染** | Marked.js + KaTeX | 完整的 Markdown 支持和数学公式渲染（v1.2.0 引入） |
| **代码高亮** | Highlight.js | 支持多种编程语言语法高亮 |
| **状态管理** | chrome.storage.local | 本地持久化存储，保障数据安全 |
| **模糊搜索** | Fuse.js | 强大的客户端搜索能力 |

### 架构设计理念

Chubby Cat 开发的核心理念是**安全、性能与模块化**，各组件职责清晰、边界明确：

| 组件 | 核心职责 |
| :--- | :--- |
| **Background（Service Worker）** | 管理 API 通信、状态持久化、MCP 工具循环及全局事件调度，作为扩展的"大脑"中枢。 |
| **Sandbox（安全沙箱）** | 隔离环境下处理 Markdown 渲染与复杂逻辑，利用 Chrome 沙箱机制确保扩展的最高安全性。 |
| **Side Panel（侧边栏）** | 利用 Chrome `sidePanel` API 提供持久且不干扰阅读的主对话界面，支持分屏操作。 |
| **Content Scripts** | 负责 DOM 交互、悬浮工具栏、手势识别及屏幕截图捕获，是扩展与网页的桥梁。 |
| **Bridge Logic** | 健壮的消息传递系统，基于 Chrome message passing 机制，确保扩展各组件间的无缝协作。 |

### 消息流架构

```
用户操作 → Content Script → Background Service Worker → AI API
                                                        ↓
响应结果 ← Sandbox 渲染 ← Background 处理 ←─────────────┘
                                                        ↓
                                              更新 Side Panel / 执行 Action
```

### 核心模块结构

```
Chubby Cat/
├── background/           # Service Worker 核心逻辑
│   ├── managers/         # 各功能管理器（会话、认证、图像、控制等）
│   ├── handlers/         # 消息处理器（会话、UI、快速提问等）
│   ├── control/          # 浏览器控制模块（Agent 模式）
│   └── lib/              # 工具库
├── content/              # Content Scripts
│   ├── toolbar/          # 智能划词工具栏
│   ├── overlay.js        # 覆盖层处理
│   ├── selection.js      # 文本选择处理
│   └── shortcuts.js      # 快捷键管理
├── sandbox/              # 安全沙箱环境
│   ├── controllers/      # 控制器逻辑
│   ├── core/             # 核心功能模块
│   ├── render/           # 渲染器（Markdown、消息、配置等）
│   └── ui/               # UI 组件（设置、侧边栏、MCP 等）
├── sidepanel/            # 侧边栏界面
├── services/             # AI 服务提供商
│   └── providers/        # 各模型 API 实现
├── lib/                  # 共享工具库
└── tests/                # 测试用例
```

## 🚀 安装与启动

### 环境要求

- [Node.js](https://nodejs.org/)（v18.0 或更高版本）
- [Vite](https://vitejs.dev/)
- Chrome 浏览器（v114+）或其他 Chromium 内核浏览器（Edge、Brave 等）

### 安装步骤

1. **克隆项目**：

   ```bash
   git clone https://github.com/hallfay0/chubby-cat.git
   cd chubby-cat
   ```

2. **安装依赖**：

   ```bash
   npm install
   ```

3. **构建扩展**：

   ```bash
   npm run build
   ```

4. **加载到 Chrome**：

   - 打开 Chrome 浏览器，访问 `chrome://extensions/`。
   - 开启右上角的 **开发者模式**。
   - 点击 **加载已解压的扩展程序**，选择项目目录下的 `dist` 文件夹。

### 开发模式

如需进行开发调试：

```bash
npm run dev
```

开发模式下，Vite 将以热更新模式运行，每次代码变更后自动刷新扩展（需在扩展管理页面点击"重新加载"）。

## 📋 使用示例

### 示例一：网页内容摘要

1. 打开任意长篇文章或论文页面。
2. 点击侧边栏中的 **"获取页面内容"** 按钮，或使用快捷键 `Alt+P`。
3. AI 将自动分析页面结构，提取关键信息并生成摘要。
4. 在侧边栏中查看摘要结果，支持进一步追问细节。

### 示例二：多标签页综合分析

1. 打开多个相关主题的标签页（如多篇新闻报道或研究报告）。
2. 点击侧边栏中的标签页选择器，勾选需要分析的标签页。
3. 点击 **"导入选中标签页"**，AI 将综合所有标签页的内容进行交叉分析。
4. 提出综合性问题，如"总结这些文章的主要观点和分歧"。

### 示例三：截图翻译与 OCR

1. 访问包含外文图片或复杂排版的网页。
2. 点击工具栏中的 **截图按钮**，或使用快捷键 `Alt+C`。
3. 在网页上框选需要翻译的区域。
4. 选择 **"截图翻译"** 功能，AI 将提取文字并提供翻译结果。

### 示例四：自动化任务执行

1. 在设置中启用 **Agent 模式** 并授权相关权限。
2. 输入自然语言指令，如"在 GitHub 上搜索 React 状态管理库并打开前三个结果"。
3. AI 将自动导航、点击、滚动页面，执行复杂的多步骤任务。
4. 实时查看执行进度和结果，支持中断和调整。

### 示例五：集成 MCP 工具

1. 启动本地 MCP 服务器（如文件系统服务）。
2. 在设置中添加 MCP 服务器地址（如 `http://localhost:3000/sse`）。
3. 勾选需要暴露的工具（如"读取文件"、"列出目录"）。
4. 发送请求，如"读取我的项目 README 并总结主要功能"，AI 将自动调用相应工具。

### 示例六：Claude 深度推理

1. 在设置中配置 Anthropic Claude API。
2. 启用 **"扩展思考"** 选项（针对支持长思考的模型）。
3. 提出需要深度推理的问题，如"分析这篇论文的创新点和潜在研究方向"。
4. Claude 将进行更深入的思考，提供更详尽的分析结果。

### 示例七：聊天记录导出

1. 完成对话后，点击侧边栏中的 **"导出"** 按钮。
2. 选择导出格式（Markdown）。
3. 聊天记录将保存为本地文件，包含时间戳、消息内容等信息。
4. 便于保存重要对话、分享或后续查阅。

## ⚙️ 配置说明

### 1. API 配置

点击扩展程序中的 **设置**（齿轮图标）配置您的模型来源：

#### Google Gemini API

- 访问 [Google AI Studio](https://aistudio.google.com/) 注册账号并获取 API Key。
- 在设置中粘贴 API Key，选择模型版本（Pro 或 Flash）。
- 建议：日常对话使用 Flash 模型以节省成本，专业任务使用 Pro 模型以获得更好效果。

#### Anthropic Claude API

- 访问 [Anthropic Console](https://console.anthropic.com/) 获取 API Key。
- 支持 Claude 3.5、Claude 3 等多版本模型。
- 可选启用 **扩展思考** 模式，提升复杂任务的推理质量。

#### 自定义 OpenAI 兼容接口

- **Base URL**：输入接口服务器地址（如 `https://api.openrouter.ai/v1`）。
- **Model ID**：输入模型标识符（如 `gpt-4o`、`deepseek-chat`）。
- **API Key**：输入对应的访问密钥。
- 支持认证头（Authorization）和自定义请求头的配置。

#### 模型自动获取

- v1.3.0 起支持自动获取可用模型列表。
- 点击"刷新模型列表"可从 API 端点获取最新可用模型。

### 2. 外部 MCP 工具配置

如需扩展 AI 的能力，可配置 MCP（Model Context Protocol）服务器：

1. **添加 MCP 服务器**：
   - 在设置中找到"MCP 服务器"页面。
   - 点击"添加服务器"，输入服务器地址（如 `http://localhost:3000/sse`）。

2. **工具授权**：
   - 服务器连接成功后，显示可用工具列表。
   - 勾选需要暴露给模型使用的工具。

3. **使用方式**：
   - 当您的请求涉及相关任务时，模型将自动调用这些工具。
   - 支持文件系统访问、数据库查询、API 调用等扩展能力。

### 3. 快捷键配置

Chubby Cat 提供丰富的快捷键支持，可在设置中自定义：

| 快捷键 | 功能 | 默认值 |
| :--- | :--- | :--- |
| 打开侧边栏 | 打开/关闭主对话侧边栏 | `Alt + S` |
| 快速截图 | 启动截图捕获模式 | `Alt + C` |
| 获取页面内容 | 导入当前页面内容 | `Alt + P` |
| 快速提问 | 打开快速提问窗口 | `Alt + Q` |

### 4. 外观设置

- **主题模式**：支持浅色/深色/跟随系统三种模式。
- **语言**：支持中文和英文界面。
- **字体大小**：可调整对话内容的显示字号。
- **Markdown 渲染**：可选择是否启用代码高亮和数学公式渲染（KaTeX）。
- **右侧边栏**：可选择是否显示右侧工具栏（v1.4.0 新增）。

### 5. 存储管理

- **自动清理**：设置对话历史的保留时长。
- **数据导出**：随时导出本地存储的数据。
- **图片上传**：配置图片处理策略和存储限制（v1.5.0 新增）。

## ❓ 常见问题（FAQ）

### Q1：侧边栏无法打开怎么办？

您可以通过以下方式打开侧边栏：
- 点击扩展图标（浏览器工具栏中的猫头图标）。
- 使用快捷键 `Alt + S`。

如果仍然无法打开：
- 尝试重启 Chrome 浏览器。
- 在 `chrome://extensions/` 页面找到 Chubby Cat，点击"重新加载"。
- 检查是否误禁用扩展权限。

### Q2：我的数据安全吗？

是的，Chubby Cat 将数据安全放在首位：
- **API 密钥**：保存在本地的 `chrome.storage.local` 中，绝不会发送给任何第三方服务器。
- **对话内容**：默认仅在本地存储，可配置自动清理策略。
- **网页内容**：读取的页面内容仅用于当前请求，不会被持久化或上传。
- **网络传输**：所有 API 请求直接与您选择的服务商通信，不经过中转服务器。

### Q3：Agent 模式如何保障安全？

Agent 模式允许 AI 执行浏览器操作，我们设计了多重安全机制：
- **权限控制**：Agent 模式默认关闭，首次使用需明确授权。
- **操作确认**：危险操作（如删除、提交表单）可配置为需用户确认。
- **范围限制**：可配置 AI 可访问的网站白名单。
- **操作日志**：所有自动化操作均有记录，可随时查看和回滚。

### Q4：支持移动端吗？

目前 **不支持**。Chubby Cat 针对桌面端 Chrome 及 Chromium 内核浏览器（Edge、Brave 等）进行了深度优化，因为它依赖于以下桌面端专用 API：
- `sidePanel` API：提供持久侧边栏。
- `debugger` API：实现浏览器自动化控制。
- `content_scripts`：深度 DOM 注入。

### Q5：为什么某些网页无法读取内容？

以下情况可能导致内容读取失败：
- **动态渲染页面**：使用 JavaScript 动态加载的内容可能无法完整抓取。
- **跨域限制**：浏览器安全策略限制对跨域 iframe 的访问。
- **网站反爬措施**：部分网站采用技术手段阻止自动化读取。
- **解决方案**：尝试使用截图功能，或在 Agent 模式下让 AI 直接导航浏览。

### Q6：如何选择合适的模型？

| 任务类型 | 推荐模型 | 说明 |
| :--- | :--- | :--- |
| 快速问答、日常对话 | Gemini Flash / GPT-4o-mini | 响应速度快，成本低 |
| 深度推理、复杂分析 | Claude 3.5 / Gemini Pro | 推理能力强，上下文理解好 |
| 长文本处理 | Claude (扩展思考) | 支持超长上下文和深度思考 |
| 代码生成 | Claude 3.5 / GPT-4o | 代码质量高，支持多种语言 |
| 翻译、OCR | Gemini Flash / Mistral OCR | 速度快，准确率高 |

### Q7：如何报告问题或提出建议？

我们欢迎社区反馈：
- **GitHub Issues**：报告 Bug 或提交功能建议。
- **功能请求**：描述您希望增加的功能和使用场景。
- **文档改进**：帮助我们完善使用文档和示例。

### Q8：免费版本与付费版本的区别？

Chubby Cat 是一款 **免费开源** 的产品，所有功能对所有用户开放。项目的运营和维护依赖于社区支持，如果您觉得本项目对您有帮助，欢迎：
- 在 GitHub 上 Star 本项目。
- 分享给需要的朋友。
- 贡献代码或文档。

### Q9：模型响应速度慢怎么办？

响应速度受多种因素影响：
- **API 服务商**：官方 API 通常比网页端更快。
- **网络环境**：检查网络连接，或尝试使用代理。
- **模型选择**：复杂任务可使用 Pro 模型，简单任务使用 Flash 模型。
- **内容大小**：减少上下文内容可加快响应速度。
- **扩展思考**：Claude 的扩展思考模式会消耗更多计算资源，响应时间较长。

### Q10：如何参与贡献？

我们欢迎社区贡献：
- **代码贡献**：Fork 项目，提交 Pull Request。
- **问题修复**：帮助修复已知的 Bug。
- **功能开发**：实现新功能或改进现有功能。
- **文档完善**：改进文档、示例或翻译。
- **测试**：编写测试用例，报告问题。

## 🙏 鸣谢

本项目基于 [gemini-nexus](https://github.com/yeahhe365/gemini-nexus) 修改，感谢原作者的开源贡献。

---

<div align="center">
  <p><i>用下一代 AI 技术赋能您的浏览器。</i></p>
</div>
